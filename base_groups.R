structure(list(genotype = structure(c(
  2L, 2L, 4L, 4L, 3L, 3L,
  9L, 9L, 9L, 9L, 11L, 11L, 10L, 10L, 10L, 10L, 10L, 5L, 5L, 5L,
  5L, 5L, 5L, 5L, 5L, 5L, 8L, 8L, 8L, 8L, 8L, 8L, 8L, 8L, 8L, 8L,
  8L, 8L, 8L, 8L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,
  1L, 1L, 1L, 1L, 6L, 6L, 6L, 6L, 6L, 6L, 6L, 6L, 6L, 6L, 7L, 7L,
  7L, 7L, 7L, 7L, 7L, 7L, 7L, 7L, 7L, 7L, 8L, 8L, 8L, 1L, 6L, 7L,
  7L, 7L, 7L, 7L
), .Label = c(
  "Col-0", "4cl1", "4cl2", "4cl1x4cl2",
  "ccoaomt1", "fah1", "omt1", "ccr1-3", "cad4", "cad5", "cad4xcad5"
), class = c("ordered", "factor")), replicate = c(
  "4", "4", "5",
  "5", "1", "1", "4", "4", "4", "4", "5", "5", "5", "5", "5", "5",
  "5", "3", "3", "3", "4", "4", "5", "5", "5", "5", "3", "3", "3",
  "3", "3", "4", "4", "4", "4", "5", "5", "5", "5", "5", "3", "3",
  "3", "3", "3", "3", "4", "4", "4", "4", "4", "5", "5", "5", "5",
  "5", "3", "3", "3", "3", "4", "4", "5", "5", "5", "5", "3", "3",
  "3", "3", "4", "4", "4", "4", "5", "5", "5", "5", "3", "3", "5",
  "3", "3", "3", "3", "4", "4", "5"
), technical = c(
  "1", "2", "2",
  "5", "1", "2", "1", "2", "3", "5", "1", "4", "1", "2", "3", "4",
  "5", "2", "4", "5", "3", "5", "1", "2", "3", "5", "1", "2", "3",
  "4", "5", "1", "2", "3", "4", "1", "2", "3", "4", "5", "1", "2",
  "3", "4", "5", "6", "1", "2", "3", "4", "5", "1", "2", "3", "4",
  "5", "1", "3", "7", "8", "2", "5", "2", "3", "4", "5", "1", "2",
  "6", "7", "2", "3", "4", "5", "1", "4", "5", "6", "4_switched",
  "5_switched", "5_switched", "8_switched", "5_switched", "6_switched",
  "7_switched", "2_switched", "3_switched", "6_switched"
), cell.type = structure(c(
  3L,
  3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L,
  3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L,
  3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L,
  3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L,
  3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L,
  3L, 3L, 3L, 3L, 3L, 3L, 3L
), .Label = c("PX", "PMX", "SMX"), class = c(
  "ordered",
  "factor"
)), variable = structure(c(
  5L, 5L, 5L, 5L, 5L, 5L, 5L,
  5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L,
  5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L,
  5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L,
  5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L,
  5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L,
  5L
), .Label = c(
  "Adj. vessels", "Area [µm²]", "Cellulose",
  "Circularity", "Convexity", "bold(G)", "bold(G)[CHOH]", "Total~bold(G)[CHO]",
  "Terminal~bold(G)[CHO]", "Perimeter [µm]", "Lignin", "bold(S)",
  "bold(S)~'/'~bold(G)", "bold(G)[CHO]~'/'~bold(G)[CHOH]", "Terminal~'/'~total~bold(G)[CHO]"
), class = "factor"), value = c(
  0.951744558258643, 0.970815886308844,
  0.9650259919721, 0.957746478873239, 0.959367851944271, 0.974206990695836,
  0.96822911870338, 0.954566003616637, 0.936051101700998, 0.959903565537368,
  0.968448023426061, 0.960356731875719, 0.952990181493603, 0.965588822355289,
  0.964885496183206, 0.973893303064699, 0.956335030782093, 0.959466875735006,
  0.944632636374255, 0.965506349106071, 0.952924818750621, 0.959238052043767,
  0.971759594496742, 0.961074800290486, 0.948703552470396, 0.952374880459037,
  0.970027506402352, 0.959745937474223, 0.955251141552511, 0.940047961630695,
  0.956488838441165, 0.951133805523527, 0.835624520620685, 0.821294581374365,
  0.785906325173341, 0.966171698298751, 0.937014459353975, 0.947531334043741,
  0.921541364584368, 0.915901898734177, 0.973605691989901, 0.976675148430874,
  0.971514800727634, 0.923496557994545, 0.963438892425207, 0.957231606510243,
  0.957446808510638, 0.972128303883809, 0.955755288509286, 0.956001113895851,
  0.964607506320088, 0.965607507867109, 0.954575421940928, 0.950460014154282,
  0.968280836031793, 0.946208187930888, 0.971456956172863, 0.966323776743458,
  0.976020468880162, 0.969818365680059, 0.96513488166823, 0.967727178207527,
  0.961071932299013, 0.959881544392915, 0.953695745595187, 0.957001102535832,
  0.959995715739303, 0.94899119067917, 0.959548855872465, 0.968107841525563,
  0.952746409384936, 0.971428571428571, 0.95207037767329, 0.95255867365248,
  0.975767206276691, 0.966361507345114, 0.963724452406156, 0.964885496183206,
  0.894436623580818, 0.898935519393124, 0.891891891891892, 0.971169325332943,
  0.977080008761225, 0.956383712905452, 0.973496835443038, 0.966977219067067,
  0.961065928361308, 0.969945788289002
)), row.names = c(NA, -88L), class = c("tbl_df", "tbl", "data.frame"))

test_model <- aov(value ~ genotype, data = test_data)

test_tukey <- agricolae::HSD.test(test_model, "genotype")

base_tukey <- TukeyHSD(test_model, "genotype")[[1]] %>%
  as_tibble(rownames = "comparison")

means <- test_data %>%
  group_by(genotype) %>%
  summarise(mean = mean(value)) %>%
  arrange(-mean)

insert <- function(x) {
  clmn <- as.character(length(x) + 1)
  prev_clmn <- pull(x, length(x))
  
  if (length(x) < 3) {
    x <- x %>%
      add_column(!!clmn := rep(1, n))
  }
  else {
    x <- x %>%
      add_column(!!clmn := prev_clmn)
  }
  return(x)
}

absorb <- function(x) {
  if (all(x[length(x)] == x[length(x) - 1])) {
    x[length(x)] <- NULL
  }
  return(x)
}

means <- insert(means)
means <- absorb(means)



n <- length(means[[1]])
i <- 5
j <- 2

for (i in i:n) {
  letter <- letters[i]
  means <- means %>%
    add_column(letter := rep(1, n))
  for (j in j:n) {
    if (
      base_tukey$`p adj`[base_tukey$comparison ==
        paste0(means$genotype[i], "-", means$genotype[j])]
      < 0.05) {
      means$`1`[i] <- NA
    }
    else {
      means$`1`[i] <- means$`1`[i]
    }
  }
}
